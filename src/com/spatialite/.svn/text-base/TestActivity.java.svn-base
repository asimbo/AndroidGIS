package com.spatialite;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.Arrays;

import jsqlite.Callback;
import jsqlite.Exception;
import jsqlite.Stmt;

import android.app.Activity;
import android.os.Bundle;
import android.os.Environment;
import android.util.Log;
import android.view.View;

public class TestActivity  extends Activity {

	private static final String TAG = TestActivity.class.getName();

	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.main);
	}
	
	public void onClick(View v) {
		if(v.getId() == R.id.button1){
			try {
				Class.forName("SQLite.JDBCDriver").newInstance();
				jsqlite.Database db = new jsqlite.Database();
				db.open(Environment.getExternalStorageDirectory()
						+ "/download/test-2.3.sqlite",
						jsqlite.Constants.SQLITE_OPEN_READONLY);
				
				Callback cb = new Callback() {
					@Override
					public void columns(String[] coldata) {
						Log.v(TAG, "Columns: " + Arrays.toString(coldata));
					}
	
					@Override
					public void types(String[] types) {
						Log.v(TAG, "Types: " + Arrays.toString(types));
					}
	
					@Override
					public boolean newrow(String[] rowdata) {
						Log.v(TAG, "Row: " + Arrays.toString(rowdata));
	
						// Careful (from parent javadoc):
						// "If true is returned the running SQLite query is aborted."
						return false;
					}
				};
				
				String query = "SELECT name, peoples, AsText(Geometry) from Towns where peoples > 350000";
				Stmt st = db.prepare(query);
				
				db.exec("select Distance(PointFromText('point(-77.35368 39.04106)', 4326), PointFromText('point(-77.35581 39.01725)', 4326));", cb);
				db.exec("SELECT name, peoples, AsText(Geometry), GeometryType(Geometry), NumPoints(Geometry), SRID(Geometry), IsValid(Geometry) from Towns where peoples > 350000;", cb);
				db.exec("SELECT Distance( Transform(MakePoint(4.430174797, 51.01047063, 4326), 32631), Transform(MakePoint(4.43001276, 51.01041585, 4326),32631));", cb);
				/*
				Class.forName("SQLite.JDBCDriver").newInstance();
				Connection conn = DriverManager.getConnection("jdbc:sqlite:/mnt/sdcard/download/test-2.3.sqlite");
				
				String query = "SELECT name, peoples, ST_GeometryType(Geometry) from Towns where peoples > 350000";
				try
			    {
			      Statement st = conn.createStatement();
			      ResultSet rs = st.executeQuery(query);
			      while (rs.next())
			      {
			    	  Log.v(TAG, "Name: " + rs.getString("name"));
			      }
			    }
			    catch (SQLException ex)
			    {
			    	ex.printStackTrace();
			    }
			    */

			} catch (IllegalAccessException e) {
				e.printStackTrace();
			} catch (InstantiationException e) {
				e.printStackTrace();
			} catch (ClassNotFoundException e) {
				e.printStackTrace();
			/*} catch (SQLException e) {
				e.printStackTrace();*/
			} catch (Exception e) {
				e.printStackTrace();
			}
		}
	}
}